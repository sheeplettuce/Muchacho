@model List<Disco>
@{
    ViewData["Title"] = "Ventas";
}
<head>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="~/css/music.css" asp-append-version="true" />
</head>

<div class="container-fluid" style="padding: 20px;">
    <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-3">
        <h1 style="color: #e4e4e4; font-weight: 600; margin: 0;">Álbumes</h1>

        <div class="d-flex gap-2 align-items-center flex-grow-1" style="max-width: 800px;">
            <!-- Buscador -->
            <div class="search" style="max-width: 400px;">
                <input type="text"
                       id="searchInput"
                       class="form-control"
                       placeholder="Buscar álbum..."
                       style="background: rgba(15, 15, 15, 0.8); color: #e4e4e4; border: 1px solid rgba(201, 169, 233, 0.2);">
               
            </div>

            <!-- Botones de acción -->
            <div class="d-flex gap-2 ms-auto">
                <a asp-controller="ProductStats" asp-action="Stats" class="btn btn-outline-warning">
                    <i class="bi bi-bar-chart"></i> Ver estadísticas
                </a>
                <a asp-action="Add" class="btn btn-success">
                    <i class="bi bi-plus-circle"></i> Agregar Álbum
                </a>
            </div>
        </div>
    </div>

    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show" role="alert"
             style="background: rgba(40, 167, 69, 0.2); border: 1px solid rgba(40, 167, 69, 0.5); color: #28a745;">
            <i class="bi bi-check-circle"></i> @TempData["Success"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" style="filter: brightness(1.5);"></button>
        </div>
    }

    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger alert-dismissible fade show" role="alert"
             style="background: rgba(220, 53, 69, 0.2); border: 1px solid rgba(220, 53, 69, 0.5); color: #dc3545;">
            <i class="bi bi-exclamation-triangle"></i> @TempData["Error"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" style="filter: brightness(1.5);"></button>
        </div>
    }

    @if (!Model.Any())
    {
        <div class="album-card text-center" style="max-width: 600px; margin: 50px auto;">
            <div class="album-info" style="padding: 40px;">
                <i class="bi bi-inbox" style="font-size: 4rem; color: #999; margin-bottom: 20px;"></i>
                <h4 class="album-title" style="white-space: normal; margin-bottom: 15px;">No hay álbumes registrados</h4>
                <p class="album-artist">Comienza agregando tu primer álbum a la colección</p>
                <a asp-action="Add" class="btn btn-success" style="width: auto !important; margin-top: 15px;">
                    <i class="bi bi-plus-circle"></i> Agregar Álbum
                </a>
            </div>
        </div>
    }
    else
    {
        <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 row-cols-xl-4 g-4">
            @foreach (var disco in Model)
            {
                <div class="col">
                    <div class="album-card">
                        <div class="album-cover-container">
                            @if (!string.IsNullOrEmpty(disco.CoverURL))
                            {
                                <img src="@disco.CoverURL" alt="@disco.Name" class="album-cover">
                            }
                            else
                            {
                                <div class="d-flex align-items-center justify-content-center"
                                     style="height: 100%; background: #0f0f0f;">
                                    <i class="bi bi-music-note-beamed" style="font-size: 4rem; color: #333;"></i>
                                </div>
                            }
                        </div>
                        <div class="album-info">
                            <h5 class="album-title" title="@disco.Name">@disco.Name</h5>
                            <p class="album-artist" title="Artista ID: @disco.ArtistId">
                                @{
                                    var artista = ViewBag.Artistas != null
                                    ? ((List<Artista>)ViewBag.Artistas).FirstOrDefault(a => a.Id == disco.ArtistId)
                                    : null;
                                }
                                @(artista?.Name ?? $"Artista ID: {disco.ArtistId}")
                            </p>
                            <p class="album-year">@(disco.Year.HasValue? disco.Year.Value.ToString() : "Año desconocido")</p>
                            <p class="album-price">$@disco.Price MXN</p>
                        </div>
                        <div class="album-actions">
                            <a asp-action="Sale" asp-route-id="@disco.Id" class="btn btn-primary btn-sm" title="Realizar Venta">
                                <i class="bi bi-cart-plus"></i> Vender
                            </a>
                            <a asp-action="Edit" asp-route-id="@disco.Id" class="btn btn-warning btn-sm" title="Editar">
                                <i class="bi bi-pencil"></i> Editar
                            </a>
                            <form asp-action="Delete" asp-route-id="@disco.Id" method="post" style="display:inline;"
                                  onsubmit="return confirm('¿Estás seguro de eliminar este álbum?');">
                                @Html.AntiForgeryToken()
                                <button type="submit" class="btn btn-danger btn-sm" title="Eliminar">
                                    <i class="bi bi-trash"></i> Eliminar
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            }
        </div>
    }

    <script>
        // Función de búsqueda en tiempo real
        document.getElementById('searchInput').addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            const albumCards = document.querySelectorAll('.album-card');

            albumCards.forEach(card => {
                const title = card.querySelector('.album-title').textContent.toLowerCase();
                const artist = card.querySelector('.album-artist').textContent.toLowerCase();
                const year = card.querySelector('.album-year').textContent.toLowerCase();

                if (title.includes(searchTerm) || artist.includes(searchTerm) || year.includes(searchTerm)) {
                    card.closest('.col').style.display = '';
                } else {
                    card.closest('.col').style.display = 'none';
                }
            });
        });

        // Limpiar búsqueda
        function clearSearch() {
            document.getElementById('searchInput').value = '';
            document.querySelectorAll('.col').forEach(col => {
                col.style.display = '';
            });
        }
    </script>

</div>